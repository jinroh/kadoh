var Lawnchair=function(a,e){if(!(this instanceof Lawnchair))return new Lawnchair(a,e);if(!JSON)throw"JSON unavailable! Include http://www.json.org/json2.js to fix.";if(2>=arguments.length&&0<arguments.length)e="function"===typeof arguments[0]?arguments[0]:arguments[1],a="function"===typeof arguments[0]?{}:arguments[0];else throw"Incorrect # of ctor args!";if("function"!==typeof e)throw"No callback was provided";this.record=a.record||"record";this.name=a.name||"records";var c;if(a.adapter)for(var b=
0,d=Lawnchair.adapters.length;b<d;b++){if(Lawnchair.adapters[b].adapter===a.adapter){c=Lawnchair.adapters[b].valid()?Lawnchair.adapters[b]:void 0;break}}else{b=0;for(d=Lawnchair.adapters.length;b<d&&!(c=Lawnchair.adapters[b].valid()?Lawnchair.adapters[b]:void 0);b++);}if(!c)throw"No valid adapter.";for(var h in c)this[h]=c[h];b=0;for(d=Lawnchair.plugins.length;b<d;b++)Lawnchair.plugins[b].call(this);this.init(a,e)};Lawnchair.adapters=[];
Lawnchair.adapter=function(a,e){e.adapter=a;var c="adapter valid init keys save batch get exists all remove nuke".split(" "),b=this.prototype.indexOf,d;for(d in e)if(-1===b(c,d))throw"Invalid adapter! Nonstandard method: "+d;Lawnchair.adapters.push(e)};Lawnchair.plugins=[];Lawnchair.plugin=function(a){for(var e in a)"init"===e?Lawnchair.plugins.push(a[e]):this.prototype[e]=a[e]};
Lawnchair.prototype={isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},indexOf:function(a,e,c,b){if(a.indexOf)return a.indexOf(e);for(c=0,b=a.length;c<b;c++)if(a[c]===e)return c;return-1},lambda:function(a){return this.fn(this.record,a)},fn:function(a,e){return"string"==typeof e?new Function(a,e):e},uuid:function(){var a=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},each:function(a){var e=
this.lambda(a);if(this.__results)for(var a=0,c=this.__results.length;a<c;a++)e.call(this,this.__results[a],a);else this.all(function(b){for(var d=0,a=b.length;d<a;d++)e.call(this,b[d],d)});return this}};
Lawnchair.adapter("dom",function(){var a=window.localStorage,e=function(c){return{key:c+"._index_",all:function(){null===JSON.parse(a.getItem(this.key))&&a.setItem(this.key,JSON.stringify([]));return JSON.parse(a.getItem(this.key))},add:function(b){var d=this.all();d.push(b);a.setItem(this.key,JSON.stringify(d))},del:function(b){for(var d=this.all(),c=[],e=0,f=d.length;e<f;e++)d[e]!=b&&c.push(d[e]);a.setItem(this.key,JSON.stringify(c))},find:function(b){for(var d=this.all(),a=0,c=d.length;a<c;a++)if(b===
d[a])return a;return!1}}};return{valid:function(){return!!a},init:function(a,b){this.indexer=e(this.name);b&&this.fn(this.name,b).call(this,this)},save:function(c,b){var d=c.key?this.name+"."+c.key:this.name+"."+this.uuid();!1===this.indexer.find(d)&&this.indexer.add(d);delete c.key;a.setItem(d,JSON.stringify(c));c.key=d.slice(this.name.length+1);b&&this.lambda(b).call(this,c);return this},batch:function(a,b){for(var d=[],h=0,e=a.length;h<e;h++)this.save(a[h],function(b){d.push(b)});b&&this.lambda(b).call(this,
d);return this},keys:function(a){if(a){var b=this.name,d=this.indexer.all().map(function(a){return a.replace(b+".","")});this.fn("keys",a).call(this,d)}return this},get:function(c,b){if(this.isArray(c)){for(var d=[],e=0,g=c.length;e<g;e++){var f=this.name+"."+c[e];if(f=JSON.parse(a.getItem(f)))f.key=c[e],d.push(f)}b&&this.lambda(b).call(this,d)}else{f=this.name+"."+c;if(f=JSON.parse(a.getItem(f)))f.key=c;b&&this.lambda(b).call(this,f)}return this},exists:function(a,b){var d=!1===this.indexer.find(this.name+
"."+a)?!1:!0;this.lambda(b).call(this,d);return this},all:function(c){for(var b=this.indexer.all(),d=[],e,g,f=0,i=b.length;f<i;f++)g=b[f],e=JSON.parse(a.getItem(g)),e.key=g.replace(this.name+".",""),d.push(e);c&&this.fn(this.name,c).call(this,d);return this},remove:function(c,b){var d=this.name+"."+(c.key?c.key:c);this.indexer.del(d);a.removeItem(d);b&&this.lambda(b).call(this);return this},nuke:function(a){this.all(function(b){for(var d=0,e=b.length;d<e;d++)this.remove(b[d]);a&&this.lambda(a).call(this)});
return this}}}());
Lawnchair.adapter("window-name",function(a,e){var c=window.top.name?JSON.parse(window.top.name):{};return{valid:function(){return"undefined"!=typeof window.top.name},init:function(b,d){c[this.name]={index:[],store:{}};a=c[this.name].index;e=c[this.name].store;this.fn(this.name,d).call(this,this)},keys:function(b){this.fn("keys",b).call(this,a);return this},save:function(b,d){var h=b.key||this.uuid();b.key&&delete b.key;this.exists(h,function(g){g||a.push(h);e[h]=b;window.top.name=JSON.stringify(c);
b.key=h;d&&this.lambda(d).call(this,b)});return this},batch:function(b,a){for(var e=[],c=0,f=b.length;c<f;c++)this.save(b[c],function(b){e.push(b)});a&&this.lambda(a).call(this,e);return this},get:function(b,a){var c;if(this.isArray(b)){c=[];for(var g=0,f=b.length;g<f;g++)c.push(e[b[g]])}else if(c=e[b])c.key=b;a&&this.lambda(a).call(this,c);return this},exists:function(a,d){this.lambda(d).call(this,!!e[a]);return this},all:function(b){for(var d=[],c=0,g=a.length;c<g;c++){var f=e[a[c]];f.key=a[c];
d.push(f)}this.fn(this.name,b).call(this,d);return this},remove:function(b,d){for(var h=this.isArray(b)?b:[b],g=0,f=h.length;g<f;g++)delete e[h[g]],a.splice(this.indexOf(a,h[g]),1);window.top.name=JSON.stringify(c);d&&this.lambda(d).call(this);return this},nuke:function(b){storage={};a=[];window.top.name=JSON.stringify(c);b&&this.lambda(b).call(this);return this}}}());